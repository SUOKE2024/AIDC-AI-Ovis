<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>索克生活MCP服务管理控制台</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    body {
      font-family: 'Microsoft YaHei', '微软雅黑', sans-serif;
      background-color: #f8f9fa;
    }
    .sidebar {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      z-index: 100;
      padding: 48px 0 0;
      box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
      background-color: #35BB78;
    }
    .sidebar-sticky {
      position: relative;
      top: 0;
      height: calc(100vh - 48px);
      padding-top: .5rem;
      overflow-x: hidden;
      overflow-y: auto;
    }
    .sidebar .nav-link {
      color: rgba(255, 255, 255, .85);
      font-weight: 500;
      padding: 10px 20px;
    }
    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      color: #fff;
      background-color: rgba(0, 0, 0, .1);
    }
    .sidebar .nav-link i {
      margin-right: 8px;
    }
    .navbar-brand {
      padding: 12px 20px;
      font-size: 1.25rem;
      background-color: #35BB78;
      color: white;
    }
    .main-content {
      margin-left: 240px;
      padding: 20px;
    }
    .card {
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, .1);
      margin-bottom: 20px;
    }
    .card-header {
      background-color: #f0f8f3;
      border-bottom: 1px solid #daebd7;
      font-weight: 600;
      color: #285b3a;
    }
    .badge-success {
      background-color: #35BB78;
      color: white;
    }
    .badge-warning {
      background-color: #FFA500;
      color: white;
    }
    .badge-danger {
      background-color: #dc3545;
      color: white;
    }
    #loginForm {
      max-width: 400px;
      margin: 100px auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, .1);
      background-color: white;
    }
    .login-logo {
      text-align: center;
      margin-bottom: 20px;
      color: #35BB78;
    }
    .login-title {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    .btn-primary {
      background-color: #35BB78;
      border-color: #35BB78;
    }
    .btn-primary:hover, .btn-primary:focus {
      background-color: #2ca066;
      border-color: #2ca066;
    }
    .spinner-border-sm {
      margin-right: 5px;
    }
    #alertBox {
      display: none;
      margin-bottom: 20px;
      width: 100%;
    }
  </style>
</head>
<body>
  <!-- 登录表单 -->
  <div id="loginForm" class="container">
    <div class="login-logo">
      <i class="bi bi-shield-lock" style="font-size: 3rem;"></i>
    </div>
    <h2 class="login-title">索克生活MCP服务管理控制台</h2>
    
    <div id="alertBox" class="alert alert-danger" role="alert"></div>
    
    <form id="loginFormElements">
      <div class="mb-3">
        <label for="username" class="form-label">用户名</label>
        <input type="text" class="form-control" id="username" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">密码</label>
        <input type="password" class="form-control" id="password" required>
      </div>
      <button type="submit" class="btn btn-primary w-100" id="loginButton">
        <span id="loginSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
        登录
      </button>
    </form>
  </div>

  <!-- 主界面 -->
  <div id="mainContent" class="d-none">
    <!-- 侧边栏 -->
    <nav class="col-md-2 d-none d-md-block sidebar">
      <div class="position-sticky sidebar-sticky">
        <h4 class="navbar-brand">索克生活MCP服务</h4>
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="#" data-page="dashboard">
              <i class="bi bi-speedometer2"></i> 仪表盘
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="resources">
              <i class="bi bi-database"></i> 资源管理
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="users">
              <i class="bi bi-people"></i> 用户管理
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="tcm">
              <i class="bi bi-journal-medical"></i> 中医知识库
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="health">
              <i class="bi bi-heart-pulse"></i> 健康数据
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="diagnostic">
              <i class="bi bi-clipboard2-pulse"></i> 诊断服务
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="recommendation">
              <i class="bi bi-heart"></i> 推荐系统
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="vectorSearch">
              <i class="bi bi-search"></i> 向量搜索
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="logs">
              <i class="bi bi-file-text"></i> 日志查看
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-page="settings">
              <i class="bi bi-gear"></i> 系统设置
            </a>
          </li>
          <li class="nav-item mt-5">
            <a class="nav-link" href="#" id="logoutButton">
              <i class="bi bi-box-arrow-right"></i> 退出登录
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- 内容区域 -->
    <main class="main-content">
      <!-- 仪表盘页面 -->
      <div id="dashboardPage" class="page-content">
        <h1 class="h2 mb-4">系统仪表盘</h1>
        
        <div class="row">
          <!-- 系统状态卡片 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">系统状态</div>
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <span>服务器状态:</span>
                  <span class="badge bg-success">运行中</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>CPU 使用率:</span>
                  <span>23%</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>内存使用率:</span>
                  <span>45%</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>启动时间:</span>
                  <span>1天4小时</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 资源统计卡片 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">资源统计</div>
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <span>中医知识库:</span>
                  <span><strong>412</strong> 条记录</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>用户数据:</span>
                  <span><strong>53</strong> 条记录</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>诊断记录:</span>
                  <span><strong>127</strong> 条记录</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>注册用户:</span>
                  <span><strong>3</strong> 位用户</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 服务状态卡片 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">服务状态</div>
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <span>HTTP服务:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>WebSocket服务:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>认证服务:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>数据存储服务:</span>
                  <span class="badge bg-success">正常</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 最近活动卡片 -->
        <div class="card mt-4">
          <div class="card-header">最近活动</div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-info me-2">查询</span>
                  <span>用户 user1 查询了中医知识库</span>
                </div>
                <span class="text-muted">2分钟前</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-warning me-2">更新</span>
                  <span>管理员更新了系统配置</span>
                </div>
                <span class="text-muted">15分钟前</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-success me-2">诊断</span>
                  <span>用户 user2 使用了舌诊分析功能</span>
                </div>
                <span class="text-muted">37分钟前</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-primary me-2">登录</span>
                  <span>管理员登录了系统</span>
                </div>
                <span class="text-muted">1小时前</span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-danger me-2">错误</span>
                  <span>系统检测到API请求错误</span>
                </div>
                <span class="text-muted">2小时前</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
      
      <!-- 其他页面内容(初始为隐藏) -->
      <div id="resourcesPage" class="page-content d-none">
        <h1 class="h2 mb-4">资源管理</h1>
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i> 资源管理页面正在开发中...
        </div>
      </div>
      
      <div id="usersPage" class="page-content d-none">
        <h1 class="h2 mb-4">用户管理</h1>
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i> 用户管理页面正在开发中...
        </div>
      </div>
      
      <div id="tcmPage" class="page-content d-none">
        <h1 class="h2 mb-4">中医知识库</h1>
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i> 中医知识库页面正在开发中...
        </div>
      </div>
      
      <div id="healthPage" class="page-content d-none">
        <h1 class="h2 mb-4">健康数据</h1>
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i> 健康数据页面正在开发中...
        </div>
      </div>
      
      <!-- 诊断服务页面 -->
      <div id="diagnosticPage" class="page-content d-none">
        <h1 class="h2 mb-4">诊断服务管理</h1>
        
        <div class="row">
          <!-- 服务状态卡片 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">服务状态</div>
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <span>舌诊分析:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>脉诊分析:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>体质分析:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>面诊分析:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>声诊分析:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>综合诊断:</span>
                  <span class="badge bg-success">正常</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 诊断工具卡片 -->
          <div class="col-md-8">
            <div class="card">
              <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="diagnosticTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="tongue-tab" data-bs-toggle="tab" data-bs-target="#tongue-content" type="button" role="tab" aria-controls="tongue-content" aria-selected="true">舌诊</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pulse-tab" data-bs-toggle="tab" data-bs-target="#pulse-content" type="button" role="tab" aria-controls="pulse-content" aria-selected="false">脉诊</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="constitution-tab" data-bs-toggle="tab" data-bs-target="#constitution-content" type="button" role="tab" aria-controls="constitution-content" aria-selected="false">体质分析</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="comprehensive-tab" data-bs-toggle="tab" data-bs-target="#comprehensive-content" type="button" role="tab" aria-controls="comprehensive-content" aria-selected="false">综合诊断</button>
                  </li>
                </ul>
              </div>
              <div class="card-body">
                <div class="tab-content" id="diagnosticTabContent">
                  <!-- 舌诊表单 -->
                  <div class="tab-pane fade show active" id="tongue-content" role="tabpanel" aria-labelledby="tongue-tab">
                    <form id="tongueForm">
                      <div class="mb-3">
                        <label for="tongueImage" class="form-label">舌象图像</label>
                        <input type="file" class="form-control" id="tongueImage" accept="image/*">
                        <div id="tonguePreview" class="mt-2"></div>
                      </div>
                      <div class="mb-3">
                        <label for="tongueUserId" class="form-label">用户ID（可选）</label>
                        <input type="text" class="form-control" id="tongueUserId" placeholder="输入用户ID">
                      </div>
                      <button type="button" class="btn btn-primary" onclick="analyzeTongue()">进行舌诊分析</button>
                    </form>
                    <div class="mt-3" id="tongueResults"></div>
                  </div>
                  
                  <!-- 脉诊表单 -->
                  <div class="tab-pane fade" id="pulse-content" role="tabpanel" aria-labelledby="pulse-tab">
                    <form id="pulseForm">
                      <div class="mb-3">
                        <label for="pulseFrequency" class="form-label">脉搏频率</label>
                        <select class="form-select" id="pulseFrequency">
                          <option value="50">缓脉 (50次/分钟)</option>
                          <option value="70" selected>正常脉 (70次/分钟)</option>
                          <option value="100">数脉 (100次/分钟)</option>
                          <option value="120">疾脉 (120次/分钟)</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="pulseStrength" class="form-label">脉搏强度: <span id="pulseStrengthValue">中等</span></label>
                        <input type="range" class="form-range" id="pulseStrength" min="0" max="1" step="0.1" value="0.5">
                      </div>
                      <div class="mb-3">
                        <label for="pulseRhythm" class="form-label">脉搏节律</label>
                        <select class="form-select" id="pulseRhythm">
                          <option value="regular" selected>规律</option>
                          <option value="irregular">不规律</option>
                          <option value="intermittent">间歇</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="pulseUserId" class="form-label">用户ID（可选）</label>
                        <input type="text" class="form-control" id="pulseUserId" placeholder="输入用户ID">
                      </div>
                      <button type="button" class="btn btn-primary" onclick="analyzePulse()">进行脉诊分析</button>
                    </form>
                    <div class="mt-3" id="pulseResults"></div>
                  </div>
                  
                  <!-- 体质分析表单 -->
                  <div class="tab-pane fade" id="constitution-content" role="tabpanel" aria-labelledby="constitution-tab">
                    <form id="constitutionForm">
                      <div class="mb-3">
                        <p class="mb-2">请回答以下问题（简化版）：</p>
                        
                        <div class="mb-2">
                          <label class="form-label">1. 您是否容易疲劳?</label>
                          <select class="form-select constitution-answer" data-question="fatigue" title="选择疲劳频率">
                            <option value="0">从不</option>
                            <option value="1">偶尔</option>
                            <option value="2" selected>有时</option>
                            <option value="3">经常</option>
                          </select>
                        </div>
                        
                        <div class="mb-2">
                          <label class="form-label">2. 您是否手脚容易冰凉?</label>
                          <select class="form-select constitution-answer" data-question="coldLimbs" title="选择手脚冰凉频率">
                            <option value="0">从不</option>
                            <option value="1">偶尔</option>
                            <option value="2" selected>有时</option>
                            <option value="3">经常</option>
                          </select>
                        </div>
                        
                        <div class="mb-2">
                          <label class="form-label">3. 您是否容易感到烦躁或易怒?</label>
                          <select class="form-select constitution-answer" data-question="irritability" title="选择烦躁易怒频率">
                            <option value="0">从不</option>
                            <option value="1" selected>偶尔</option>
                            <option value="2">有时</option>
                            <option value="3">经常</option>
                          </select>
                        </div>
                        
                        <div class="mb-2">
                          <label class="form-label">4. 您是否容易出汗?</label>
                          <select class="form-select constitution-answer" data-question="sweating" title="选择出汗频率">
                            <option value="0">从不</option>
                            <option value="1">偶尔</option>
                            <option value="2" selected>有时</option>
                            <option value="3">经常</option>
                          </select>
                        </div>
                        
                        <div class="mb-2">
                          <label class="form-label">5. 您是否口干舌燥?</label>
                          <select class="form-select constitution-answer" data-question="dryMouth" title="选择口干舌燥频率">
                            <option value="0" selected>从不</option>
                            <option value="1">偶尔</option>
                            <option value="2">有时</option>
                            <option value="3">经常</option>
                          </select>
                        </div>
                      </div>
                      
                      <div class="mb-3">
                        <label for="constitutionUserId" class="form-label">用户ID（可选）</label>
                        <input type="text" class="form-control" id="constitutionUserId" placeholder="输入用户ID">
                      </div>
                      <button type="button" class="btn btn-primary" onclick="analyzeConstitution()">进行体质分析</button>
                    </form>
                    <div class="mt-3" id="constitutionResults"></div>
                  </div>
                  
                  <!-- 综合诊断表单 -->
                  <div class="tab-pane fade" id="comprehensive-content" role="tabpanel" aria-labelledby="comprehensive-tab">
                    <form id="comprehensiveForm">
                      <div class="mb-3">
                        <p>选择要包含的诊断数据：</p>
                        <div class="mb-2 form-check">
                          <input type="checkbox" class="form-check-input diagnostic-option" id="includeTongue" checked>
                          <label class="form-check-label" for="includeTongue">舌诊</label>
                        </div>
                        <div class="mb-2 form-check">
                          <input type="checkbox" class="form-check-input diagnostic-option" id="includePulse" checked>
                          <label class="form-check-label" for="includePulse">脉诊</label>
                        </div>
                        <div class="mb-2 form-check">
                          <input type="checkbox" class="form-check-input diagnostic-option" id="includeFace">
                          <label class="form-check-label" for="includeFace">面诊</label>
                        </div>
                        <div class="mb-2 form-check">
                          <input type="checkbox" class="form-check-input diagnostic-option" id="includeVoice">
                          <label class="form-check-label" for="includeVoice">声诊</label>
                        </div>
                        <div class="mb-2 form-check">
                          <input type="checkbox" class="form-check-input diagnostic-option" id="includeConstitution" checked>
                          <label class="form-check-label" for="includeConstitution">体质问卷</label>
                        </div>
                      </div>
                      
                      <div class="mb-3">
                        <label for="comprehensiveUserId" class="form-label">用户ID（可选）</label>
                        <input type="text" class="form-control" id="comprehensiveUserId" placeholder="输入用户ID">
                      </div>
                      <button type="button" class="btn btn-primary" onclick="analyzeComprehensive()">进行综合诊断</button>
                    </form>
                    <div class="mt-3" id="comprehensiveResults"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 诊断历史查询 -->
        <div class="row mt-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header">诊断历史查询</div>
              <div class="card-body">
                <form id="diagnosticHistoryForm" class="mb-4">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label for="historyUserId" class="form-label">用户ID</label>
                        <input type="text" class="form-control" id="historyUserId" placeholder="输入用户ID" required>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label for="historyType" class="form-label">诊断类型</label>
                        <select class="form-select" id="historyType" title="选择诊断类型">
                          <option value="">所有类型</option>
                          <option value="tongue">舌诊</option>
                          <option value="pulse">脉诊</option>
                          <option value="constitution">体质分析</option>
                          <option value="face">面诊</option>
                          <option value="voice">声诊</option>
                          <option value="comprehensive">综合诊断</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="mb-3">
                        <label for="historyLimit" class="form-label">结果数量</label>
                        <input type="number" class="form-control" id="historyLimit" value="10" min="1" max="100">
                      </div>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                      <button type="button" class="btn btn-primary mb-3 w-100" onclick="getDiagnosticHistory()">查询</button>
                    </div>
                  </div>
                </form>
                
                <div id="historyResults"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 推荐系统页面 -->
      <div id="recommendationPage" class="page-content d-none">
        <h1 class="h2 mb-4">推荐系统管理</h1>
        
        <div class="row">
          <!-- 服务状态卡片 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">服务状态</div>
              <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                  <span>健康方案推荐:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>药膳食疗推荐:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>治疗方案推荐:</span>
                  <span class="badge bg-success">正常</span>
                </div>
                <div class="mt-3 pt-2 border-top">
                  <div class="d-flex justify-content-between mb-2">
                    <span>模板总数:</span>
                    <span><strong>15</strong></span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span>食谱总数:</span>
                    <span><strong>124</strong></span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span>生成方案数:</span>
                    <span><strong>352</strong></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 生成测试卡片 -->
          <div class="col-md-8">
            <div class="card">
              <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs" id="recommendationTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="health-plan-tab" data-bs-toggle="tab" data-bs-target="#health-plan-content" type="button" role="tab" aria-controls="health-plan-content" aria-selected="true">健康方案</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="herb-food-tab" data-bs-toggle="tab" data-bs-target="#herb-food-content" type="button" role="tab" aria-controls="herb-food-content" aria-selected="false">药膳食疗</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="treatment-tab" data-bs-toggle="tab" data-bs-target="#treatment-content" type="button" role="tab" aria-controls="treatment-content" aria-selected="false">治疗方案</button>
                  </li>
                </ul>
              </div>
              <div class="card-body">
                <div class="tab-content" id="recommendationTabContent">
                  <!-- 健康方案表单 -->
                  <div class="tab-pane fade show active" id="health-plan-content" role="tabpanel" aria-labelledby="health-plan-tab">
                    <form id="healthPlanForm">
                      <div class="mb-3">
                        <label for="healthUserId" class="form-label">用户ID</label>
                        <input type="text" class="form-control" id="healthUserId" placeholder="输入用户ID">
                      </div>
                      <div class="mb-3">
                        <label for="healthConstitution" class="form-label">体质类型</label>
                        <select class="form-select" id="healthConstitution" title="选择体质类型">
                          <option value="">-- 选择体质类型 --</option>
                          <option value="平和质">平和质</option>
                          <option value="气虚质">气虚质</option>
                          <option value="阳虚质">阳虚质</option>
                          <option value="阴虚质">阴虚质</option>
                          <option value="痰湿质">痰湿质</option>
                          <option value="湿热质">湿热质</option>
                          <option value="血瘀质">血瘀质</option>
                          <option value="气郁质">气郁质</option>
                          <option value="特禀质">特禀质</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="healthConditions" class="form-label">健康状况</label>
                        <input type="text" class="form-control" id="healthConditions" placeholder="输入健康状况，如'高血压,失眠'">
                      </div>
                      <button type="button" class="btn btn-primary" onclick="generateHealthPlan()">生成健康方案</button>
                    </form>
                    <div class="mt-3">
                      <h5>生成结果</h5>
                      <pre id="healthPlanOutput" class="p-3 bg-light rounded">方案将在这里显示</pre>
                    </div>
                  </div>
                  
                  <!-- 药膳食疗表单 -->
                  <div class="tab-pane fade" id="herb-food-content" role="tabpanel" aria-labelledby="herb-food-tab">
                    <form id="herbFoodForm">
                      <div class="mb-3">
                        <label for="herbFoodUserId" class="form-label">用户ID</label>
                        <input type="text" class="form-control" id="herbFoodUserId" placeholder="输入用户ID">
                      </div>
                      <div class="mb-3">
                        <label for="herbFoodConstitution" class="form-label">体质类型</label>
                        <select class="form-select" id="herbFoodConstitution" title="选择体质类型">
                          <option value="">-- 选择体质类型 --</option>
                          <option value="平和质">平和质</option>
                          <option value="气虚质">气虚质</option>
                          <option value="阳虚质">阳虚质</option>
                          <option value="阴虚质">阴虚质</option>
                          <option value="痰湿质">痰湿质</option>
                          <option value="湿热质">湿热质</option>
                          <option value="血瘀质">血瘀质</option>
                          <option value="气郁质">气郁质</option>
                          <option value="特禀质">特禀质</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="herbFoodSeason" class="form-label">季节</label>
                        <select class="form-select" id="herbFoodSeason" title="选择季节">
                          <option value="">-- 选择季节 --</option>
                          <option value="春">春季</option>
                          <option value="夏">夏季</option>
                          <option value="秋">秋季</option>
                          <option value="冬">冬季</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="herbFoodSymptoms" class="form-label">症状</label>
                        <input type="text" class="form-control" id="herbFoodSymptoms" placeholder="输入症状，如'消化不良,乏力'">
                      </div>
                      <button type="button" class="btn btn-primary" onclick="generateHerbFood()">生成药膳食疗方案</button>
                    </form>
                    <div class="mt-3">
                      <h5>生成结果</h5>
                      <pre id="herbFoodOutput" class="p-3 bg-light rounded">方案将在这里显示</pre>
                    </div>
                  </div>
                  
                  <!-- 治疗方案表单 -->
                  <div class="tab-pane fade" id="treatment-content" role="tabpanel" aria-labelledby="treatment-tab">
                    <form id="treatmentForm">
                      <div class="mb-3">
                        <label for="treatmentUserId" class="form-label">用户ID</label>
                        <input type="text" class="form-control" id="treatmentUserId" placeholder="输入用户ID">
                      </div>
                      <div class="mb-3">
                        <label for="treatmentPattern" class="form-label">证型</label>
                        <select class="form-select" id="treatmentPattern" title="选择证型">
                          <option value="">-- 选择证型 --</option>
                          <option value="肝郁气滞">肝郁气滞</option>
                          <option value="脾胃虚弱">脾胃虚弱</option>
                          <option value="肺气亏虚">肺气亏虚</option>
                          <option value="肾阴亏虚">肾阴亏虚</option>
                          <option value="肾阳不足">肾阳不足</option>
                          <option value="气滞血瘀">气滞血瘀</option>
                          <option value="痰湿阻肺">痰湿阻肺</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="treatmentSymptoms" class="form-label">症状详情</label>
                        <textarea class="form-control" id="treatmentSymptoms" rows="3" placeholder="输入症状详情"></textarea>
                      </div>
                      <div class="mb-3">
                        <label for="treatmentHistory" class="form-label">病史</label>
                        <textarea class="form-control" id="treatmentHistory" rows="2" placeholder="输入相关病史"></textarea>
                      </div>
                      <button type="button" class="btn btn-primary" onclick="generateTreatmentPlan()">生成治疗方案</button>
                    </form>
                    <div class="mt-3">
                      <h5>生成结果</h5>
                      <pre id="treatmentOutput" class="p-3 bg-light rounded">方案将在这里显示</pre>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 用户方案查询 -->
        <div class="row mt-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header">用户方案查询</div>
              <div class="card-body">
                <form id="planQueryForm" class="mb-4">
                  <div class="row">
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label for="queryUserId" class="form-label">用户ID</label>
                        <input type="text" class="form-control" id="queryUserId" placeholder="输入用户ID">
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="mb-3">
                        <label for="queryPlanType" class="form-label">方案类型</label>
                        <select class="form-select" id="queryPlanType" title="选择方案类型">
                          <option value="">全部</option>
                          <option value="health_plan">健康方案</option>
                          <option value="herb_food">药膳食疗</option>
                          <option value="treatment_plan">治疗方案</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="mb-3">
                        <label for="queryLimit" class="form-label">结果数量</label>
                        <input type="number" class="form-control" id="queryLimit" value="10" min="1" max="100">
                      </div>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                      <button type="button" class="btn btn-primary mb-3 w-100" onclick="queryUserPlans()">查询方案</button>
                    </div>
                  </div>
                </form>
                
                <div class="table-responsive">
                  <table class="table table-striped" id="plansTable">
                    <thead>
                      <tr>
                        <th scope="col">ID</th>
                        <th scope="col">类型</th>
                        <th scope="col">名称</th>
                        <th scope="col">创建时间</th>
                        <th scope="col">操作</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td colspan="5" class="text-center">请先进行查询</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 向量搜索页面 -->
      <div id="vectorSearchPage" class="page-content d-none">
        <h1 class="h2 mb-4">向量搜索管理</h1>
        
        <div class="row">
          <!-- 服务状态卡片 -->
          <div class="col-md-4">
            <div class="card">
              <div class="card-header">服务状态</div>
              <div class="card-body" id="vectorSearchStatus">
                <div class="d-flex justify-content-between mb-2">
                  <span>状态:</span>
                  <span class="badge bg-secondary">加载中...</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>文档总数:</span>
                  <span>--</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>索引类型:</span>
                  <span>--</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 搜索测试 -->
        <div class="card mt-4">
          <div class="card-header">语义搜索测试</div>
          <div class="card-body">
            <form id="vectorSearchForm">
              <div class="mb-3">
                <label for="searchQuery" class="form-label">搜索文本</label>
                <textarea class="form-control" id="searchQuery" rows="2" placeholder="输入要搜索的文本内容"></textarea>
              </div>
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="searchLimit" class="form-label">结果数量</label>
                  <input type="number" class="form-control" id="searchLimit" value="5" min="1" max="50">
                </div>
                <div class="col-md-4">
                  <label for="searchMinScore" class="form-label">最小相似度</label>
                  <input type="number" class="form-control" id="searchMinScore" value="0.5" min="0" max="1" step="0.1">
                </div>
                <div class="col-md-4">
                  <label for="searchFilterType" class="form-label">过滤类型</label>
                  <input type="text" class="form-control" id="searchFilterType" placeholder="可选">
                </div>
              </div>
              <button type="submit" class="btn btn-primary">搜索</button>
            </form>
            
            <div class="mt-4" id="searchResults">
              <div class="alert alert-secondary">搜索结果将显示在这里</div>
            </div>
          </div>
        </div>
        
        <!-- 添加文档 -->
        <div class="card mt-4">
          <div class="card-header">添加文档</div>
          <div class="card-body">
            <form id="addDocumentForm">
              <div class="mb-3">
                <label for="documentContent" class="form-label">文档内容</label>
                <textarea class="form-control" id="documentContent" rows="4" placeholder="输入要添加的文档内容"></textarea>
              </div>
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="documentTitle" class="form-label">标题</label>
                  <input type="text" class="form-control" id="documentTitle" placeholder="文档标题">
                </div>
                <div class="col-md-4">
                  <label for="documentType" class="form-label">类型</label>
                  <input type="text" class="form-control" id="documentType" placeholder="文档类型">
                </div>
                <div class="col-md-4">
                  <label for="documentSource" class="form-label">来源</label>
                  <input type="text" class="form-control" id="documentSource" placeholder="文档来源">
                </div>
              </div>
              <button type="submit" class="btn btn-success">添加文档</button>
            </form>
            
            <div class="mt-3" id="addDocumentResult"></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 获取DOM元素
      const loginForm = document.getElementById('loginForm');
      const loginFormElements = document.getElementById('loginFormElements');
      const mainContent = document.getElementById('mainContent');
      const loginButton = document.getElementById('loginButton');
      const loginSpinner = document.getElementById('loginSpinner');
      const alertBox = document.getElementById('alertBox');
      const logoutButton = document.getElementById('logoutButton');
      const navLinks = document.querySelectorAll('.nav-link[data-page]');
      
      // 检查登录状态
      checkAuthStatus();
      
      // 登录表单提交
      loginFormElements.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        if (!username || !password) {
          showAlert('用户名和密码不能为空');
          return;
        }
        
        // 显示加载状态
        loginButton.disabled = true;
        loginSpinner.classList.remove('d-none');
        
        // 发送登录请求
        fetch('/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(data => {
          if (data.token) {
            // 登录成功，保存token
            localStorage.setItem('authToken', data.token);
            localStorage.setItem('userData', JSON.stringify(data.user));
            
            // 显示主界面
            showMainContent();
          } else {
            // 登录失败
            throw new Error(data.error?.message || '登录失败');
          }
        })
        .catch(error => {
          console.error('Login error:', error);
          showAlert(error.message || '登录失败，请检查用户名和密码');
          
          // 恢复按钮状态
          loginButton.disabled = false;
          loginSpinner.classList.add('d-none');
        });
      });
      
      // 退出登录
      logoutButton.addEventListener('click', function(e) {
        e.preventDefault();
        localStorage.removeItem('authToken');
        localStorage.removeItem('userData');
        showLoginForm();
      });
      
      // 导航菜单切换
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          
          // 更新活动标签
          navLinks.forEach(l => l.classList.remove('active'));
          this.classList.add('active');
          
          // 显示对应页面
          const pageName = this.getAttribute('data-page');
          showPage(pageName);
        });
      });
      
      // 检查认证状态
      function checkAuthStatus() {
        const token = localStorage.getItem('authToken');
        
        if (token) {
          // 验证令牌
          fetch('/auth/verify', {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          })
          .then(response => {
            if (response.ok) {
              showMainContent();
              return;
            }
            throw new Error('认证失败');
          })
          .catch(error => {
            console.error('Auth verification error:', error);
            showLoginForm();
          });
        } else {
          showLoginForm();
        }
      }
      
      // 显示登录表单
      function showLoginForm() {
        loginForm.classList.remove('d-none');
        mainContent.classList.add('d-none');
        
        // 重置表单
        loginFormElements.reset();
        loginButton.disabled = false;
        loginSpinner.classList.add('d-none');
        alertBox.style.display = 'none';
      }
      
      // 显示主界面
      function showMainContent() {
        loginForm.classList.add('d-none');
        mainContent.classList.remove('d-none');
        
        // 默认显示仪表盘
        showPage('dashboard');
        
        // 加载向量搜索状态
        loadVectorSearchStatus();
      }
      
      // 显示指定页面
      function showPage(pageName) {
        const pages = document.querySelectorAll('.page-content');
        pages.forEach(page => page.classList.add('d-none'));
        
        const targetPage = document.getElementById(`${pageName}Page`);
        if (targetPage) {
          targetPage.classList.remove('d-none');
        }
      }
      
      // 显示警告信息
      function showAlert(message) {
        alertBox.textContent = message;
        alertBox.style.display = 'block';
      }
      
      // 处理向量搜索相关功能
      const vectorSearchForm = document.getElementById('vectorSearchForm');
      const addDocumentForm = document.getElementById('addDocumentForm');
      
      if (vectorSearchForm) {
        vectorSearchForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const query = document.getElementById('searchQuery').value;
          const limit = document.getElementById('searchLimit').value;
          const minScore = document.getElementById('searchMinScore').value;
          const filterType = document.getElementById('searchFilterType').value;
          
          if (!query) {
            alert('请输入搜索文本');
            return;
          }
          
          const searchData = {
            query: query,
            limit: parseInt(limit),
            minScore: parseFloat(minScore)
          };
          
          if (filterType) {
            searchData.filterType = filterType;
          }
          
          const token = localStorage.getItem('authToken');
          
          fetch('/api/vector-search/search', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': token ? `Bearer ${token}` : ''
            },
            body: JSON.stringify(searchData)
          })
          .then(response => response.json())
          .then(data => {
            const resultsContainer = document.getElementById('searchResults');
            
            if (data.error) {
              resultsContainer.innerHTML = `
                <div class="alert alert-danger">
                  搜索失败: ${data.error}
                </div>
              `;
              return;
            }
            
            if (!data.results || data.results.length === 0) {
              resultsContainer.innerHTML = `
                <div class="alert alert-warning">
                  未找到匹配的结果
                </div>
              `;
              return;
            }
            
            let resultsHtml = `
              <h5>找到 ${data.results.length} 个结果:</h5>
              <div class="list-group">
            `;
            
            data.results.forEach(result => {
              resultsHtml += `
                <div class="list-group-item">
                  <div class="d-flex justify-content-between">
                    <h6>${result.document.title || '无标题'}</h6>
                    <span class="badge bg-info">相似度: ${(result.score * 100).toFixed(2)}%</span>
                  </div>
                  <p class="mb-1">${result.document.content || result.document.text || JSON.stringify(result.document)}</p>
                  <small class="text-muted">类型: ${result.document.type || '未知'} | ID: ${result.document.id}</small>
                </div>
              `;
            });
            
            resultsHtml += '</div>';
            resultsContainer.innerHTML = resultsHtml;
          })
          .catch(error => {
            console.error('Search error:', error);
            document.getElementById('searchResults').innerHTML = `
              <div class="alert alert-danger">
                搜索请求失败: ${error.message}
              </div>
            `;
          });
        });
      }
      
      if (addDocumentForm) {
        addDocumentForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const content = document.getElementById('documentContent').value;
          const title = document.getElementById('documentTitle').value;
          const type = document.getElementById('documentType').value;
          const source = document.getElementById('documentSource').value;
          
          if (!content) {
            alert('请输入文档内容');
            return;
          }
          
          const documentData = {
            document: {
              content: content,
              text: content,
              created_at: new Date().toISOString()
            }
          };
          
          if (title) documentData.document.title = title;
          if (type) documentData.document.type = type;
          if (source) documentData.document.source = source;
          
          const token = localStorage.getItem('authToken');
          
          if (!token) {
            alert('需要登录才能添加文档');
            return;
          }
          
          fetch('/api/vector-search/documents', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(documentData)
          })
          .then(response => response.json())
          .then(data => {
            const resultContainer = document.getElementById('addDocumentResult');
            
            if (data.error) {
              resultContainer.innerHTML = `
                <div class="alert alert-danger">
                  添加文档失败: ${data.error}
                </div>
              `;
              return;
            }
            
            resultContainer.innerHTML = `
              <div class="alert alert-success">
                文档添加成功! 文档ID: ${data.id}
              </div>
            `;
            
            // 清空表单
            document.getElementById('documentContent').value = '';
            document.getElementById('documentTitle').value = '';
            document.getElementById('documentType').value = '';
            document.getElementById('documentSource').value = '';
            
            // 刷新向量搜索状态
            loadVectorSearchStatus();
          })
          .catch(error => {
            console.error('Add document error:', error);
            document.getElementById('addDocumentResult').innerHTML = `
              <div class="alert alert-danger">
                添加文档请求失败: ${error.message}
              </div>
            `;
          });
        });
      }
      
      // 加载向量搜索状态
      function loadVectorSearchStatus() {
        const statusContainer = document.getElementById('vectorSearchStatus');
        if (!statusContainer) return;
        
        fetch('/api/vector-search/status')
          .then(response => response.json())
          .then(data => {
            if (data.error) {
              statusContainer.innerHTML = `
                <div class="alert alert-danger">
                  获取状态失败: ${data.error}
                </div>
              `;
              return;
            }
            
            statusContainer.innerHTML = `
              <div class="d-flex justify-content-between mb-2">
                <span>状态:</span>
                <span class="badge bg-success">${data.status || '离线'}</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>文档总数:</span>
                <span>${data.documentCount || 0}</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>索引类型:</span>
                <span>${data.indexType || 'unknown'}</span>
              </div>
            `;
          })
          .catch(error => {
            console.error('Get status error:', error);
            statusContainer.innerHTML = `
              <div class="alert alert-danger">
                获取状态失败: ${error.message}
              </div>
            `;
          });
      }
      
      // 舌诊分析测试功能
      function analyzeTongue() {
        const fileInput = document.getElementById('tongueImage');
        const userId = document.getElementById('tongueUserId').value.trim();
        const resultsContainer = document.getElementById('tongueResults');
        
        if (!fileInput.files || fileInput.files.length === 0) {
          showAlert('请选择舌象图像');
          return;
        }
        
        const file = fileInput.files[0];
        const reader = new FileReader();
        
        reader.onload = async function(event) {
          const imageData = event.target.result;
          
          resultsContainer.innerHTML = '<div class="loading">分析中，请稍候...</div>';
          
          try {
            const response = await fetch('/api/diagnostic/tongue', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
              },
              body: JSON.stringify({
                imageData,
                userId: userId || undefined
              })
            });
            
            if (!response.ok) {
              throw new Error(`请求失败: ${response.status}`);
            }
            
            const result = await response.json();
            
            let html = `<h3>舌诊分析结果 (ID: ${result.id})</h3>`;
            html += `<p><strong>诊断结果：</strong> ${result.diagnosis}</p>`;
            
            html += '<p><strong>舌象特征：</strong></p>';
            html += '<ul>';
            for (const feature of result.features) {
              html += `<li>${feature}</li>`;
            }
            html += '</ul>';
            
            html += '<p><strong>调理建议：</strong></p>';
            html += '<ul>';
            for (const recommendation of result.recommendations) {
              html += `<li>${recommendation}</li>`;
            }
            html += '</ul>';
            
            resultsContainer.innerHTML = html;
          } catch (error) {
            resultsContainer.innerHTML = `<div class="error">分析失败: ${error.message}</div>`;
          }
        };
        
        reader.readAsDataURL(file);
      }
      
      // 面诊分析测试功能
      function analyzeFace() {
        const fileInput = document.getElementById('faceImage');
        const userId = document.getElementById('faceUserId').value.trim();
        const resultsContainer = document.getElementById('faceResults');
        
        if (!fileInput.files || fileInput.files.length === 0) {
          showAlert('请选择面部图像');
          return;
        }
        
        const file = fileInput.files[0];
        const reader = new FileReader();
        
        reader.onload = async function(event) {
          const imageData = event.target.result;
          
          resultsContainer.innerHTML = '<div class="loading">分析中，请稍候...</div>';
          
          try {
            const response = await fetch('/api/diagnostic/face', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
              },
              body: JSON.stringify({
                imageData,
                userId: userId || undefined
              })
            });
            
            if (!response.ok) {
              throw new Error(`请求失败: ${response.status}`);
            }
            
            const result = await response.json();
            
            let html = `<h3>面诊分析结果 (ID: ${result.id})</h3>`;
            html += `<p><strong>诊断结果：</strong> ${result.diagnosis}</p>`;
            html += `<p><strong>面色：</strong> ${result.complexion}</p>`;
            html += `<p><strong>面型：</strong> ${result.faceShape}</p>`;
            
            html += '<p><strong>面诊特征：</strong></p>';
            html += '<ul>';
            for (const feature of result.features) {
              html += `<li>${feature}</li>`;
            }
            html += '</ul>';
            
            html += '<p><strong>调理建议：</strong></p>';
            html += '<ul>';
            for (const recommendation of result.recommendations) {
              html += `<li>${recommendation}</li>`;
            }
            html += '</ul>';
            
            resultsContainer.innerHTML = html;
          } catch (error) {
            resultsContainer.innerHTML = `<div class="error">分析失败: ${error.message}</div>`;
          }
        };
        
        reader.readAsDataURL(file);
      }
      
      // 声诊分析测试功能
      function analyzeVoice() {
        const fileInput = document.getElementById('voiceAudio');
        const userId = document.getElementById('voiceUserId').value.trim();
        const resultsContainer = document.getElementById('voiceResults');
        
        resultsContainer.innerHTML = '<div class="loading">分析中，请稍候...</div>';
        
        // 检查是使用上传的音频还是手动输入的特征
        let requestData = {
          userId: userId || undefined
        };
        
        // 如果有文件，读取音频文件
        if (fileInput.files && fileInput.files.length > 0) {
          const file = fileInput.files[0];
          const reader = new FileReader();
          
          reader.onload = async function(event) {
            const audioData = event.target.result;
            requestData.audioData = audioData;
            
            await sendVoiceAnalysisRequest(requestData, resultsContainer);
          };
          
          reader.readAsDataURL(file);
        } else {
          // 使用手动输入的声音特征
          requestData.voiceFeatures = {
            voiceType: document.getElementById('voiceType').value,
            volume: document.getElementById('voiceVolume').value,
            pitch: document.getElementById('voicePitch').value,
            speechRate: document.getElementById('speechRate').value
          };
          
          sendVoiceAnalysisRequest(requestData, resultsContainer);
        }
      }
      
      // 发送声诊分析请求
      async function sendVoiceAnalysisRequest(requestData, resultsContainer) {
        try {
          const response = await fetch('/api/diagnostic/voice', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
            },
            body: JSON.stringify(requestData)
          });
          
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          
          const result = await response.json();
          
          let html = `<h3>声诊分析结果 (ID: ${result.id})</h3>`;
          html += `<p><strong>诊断结果：</strong> ${result.diagnosis}</p>`;
          html += `<p><strong>声音类型：</strong> ${result.voiceType}</p>`;
          html += `<p><strong>语速：</strong> ${result.speechRate}</p>`;
          html += `<p><strong>音量：</strong> ${result.volume}</p>`;
          html += `<p><strong>音调：</strong> ${result.pitch}</p>`;
          
          html += '<p><strong>声音特征：</strong></p>';
          html += '<ul>';
          for (const characteristic of result.voiceCharacteristics) {
            html += `<li>${characteristic}</li>`;
          }
          html += '</ul>';
          
          html += '<p><strong>调理建议：</strong></p>';
          html += '<ul>';
          for (const recommendation of result.recommendations) {
            html += `<li>${recommendation}</li>`;
          }
          html += '</ul>';
          
          resultsContainer.innerHTML = html;
        } catch (error) {
          resultsContainer.innerHTML = `<div class="error">分析失败: ${error.message}</div>`;
        }
      }
      
      // 综合诊断分析测试功能
      function analyzeComprehensive() {
        const userId = document.getElementById('comprehensiveUserId').value.trim();
        const resultsContainer = document.getElementById('comprehensiveResults');
        
        resultsContainer.innerHTML = '<div class="loading">分析中，请稍候...</div>';
        
        // 检查选择的诊断类型
        const includeTongue = document.getElementById('includeTongue').checked;
        const includePulse = document.getElementById('includePulse').checked;
        const includeFace = document.getElementById('includeFace').checked;
        const includeVoice = document.getElementById('includeVoice').checked;
        const includeConstitution = document.getElementById('includeConstitution').checked;
        
        const selectedCount = [includeTongue, includePulse, includeFace, includeVoice, includeConstitution].filter(Boolean).length;
        
        if (selectedCount < 2) {
          resultsContainer.innerHTML = '<div class="error">至少需要选择两种诊断类型</div>';
          return;
        }
        
        // 准备请求数据
        let requestData = {
          userId: userId || undefined
        };
        
        // 收集舌诊数据
        if (includeTongue) {
          const tongueFileInput = document.getElementById('comprehensiveTongueImage');
          if (tongueFileInput.files && tongueFileInput.files.length > 0) {
            const tongueReader = new FileReader();
            tongueReader.onload = event => {
              requestData.tongueImageData = event.target.result;
              continueCollection();
            };
            tongueReader.readAsDataURL(tongueFileInput.files[0]);
            return;
          } else {
            resultsContainer.innerHTML = '<div class="error">请上传舌象图像</div>';
            return;
          }
        }
        
        continueCollection();
        
        function continueCollection() {
          // 收集脉诊数据
          if (includePulse) {
            const frequency = document.getElementById('comprehensivePulseFrequency').value;
            const strength = document.getElementById('comprehensivePulseStrength').value;
            const rhythm = document.getElementById('comprehensivePulseRhythm').value;
            
            requestData.pulseData = {
              frequency: parseInt(frequency),
              strength: parseFloat(strength),
              rhythm
            };
          }
          
          // 收集面诊数据
          if (includeFace) {
            const faceFileInput = document.getElementById('comprehensiveFaceImage');
            if (faceFileInput.files && faceFileInput.files.length > 0) {
              const faceReader = new FileReader();
              faceReader.onload = event => {
                requestData.faceImageData = event.target.result;
                continueVoiceCollection();
              };
              faceReader.readAsDataURL(faceFileInput.files[0]);
              return;
            } else {
              resultsContainer.innerHTML = '<div class="error">请上传面部图像</div>';
              return;
            }
          }
          
          continueVoiceCollection();
        }
        
        function continueVoiceCollection() {
          // 收集声诊数据
          if (includeVoice) {
            requestData.voiceFeatures = {
              voiceType: document.getElementById('comprehensiveVoiceType').value,
              volume: document.getElementById('comprehensiveVoiceVolume').value,
              speechRate: document.getElementById('comprehensiveSpeechRate').value
            };
          }
          
          // 收集体质问卷数据
          if (includeConstitution) {
            requestData.userAnswers = {
              '疲劳': document.getElementById('comprehensiveQ1').value,
              '手脚冰凉': document.getElementById('comprehensiveQ2').value
            };
          }
          
          // 发送请求
          sendComprehensiveRequest(requestData);
        }
      }
      
      // 发送综合诊断请求
      async function sendComprehensiveRequest(requestData) {
        const resultsContainer = document.getElementById('comprehensiveResults');
        
        try {
          const response = await fetch('/api/diagnostic/comprehensive', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
            },
            body: JSON.stringify(requestData)
          });
          
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          
          const result = await response.json();
          
          let html = `<h3>综合诊断结果 (ID: ${result.id})</h3>`;
          html += `<p><strong>主要诊断：</strong> ${result.diagnosis}</p>`;
          
          if (result.disharmonies && result.disharmonies.length > 0) {
            html += '<p><strong>不和谐模式：</strong></p>';
            html += '<ul>';
            for (const disharmony of result.disharmonies) {
              html += `<li>${disharmony}</li>`;
            }
            html += '</ul>';
          }
          
          if (result.individualDiagnoses) {
            html += '<p><strong>各项诊断结果：</strong></p>';
            html += '<ul>';
            for (const [type, diagnosis] of Object.entries(result.individualDiagnoses)) {
              html += `<li>${getDiagnosticTypeLabel(type)}: ${diagnosis}</li>`;
            }
            html += '</ul>';
          }
          
          if (result.recommendations && result.recommendations.length > 0) {
            html += '<p><strong>综合调理建议：</strong></p>';
            html += '<ul>';
            for (const recommendation of result.recommendations) {
              html += `<li>${recommendation}</li>`;
            }
            html += '</ul>';
          }
          
          if (result.herbRecommendations && result.herbRecommendations.length > 0) {
            html += '<p><strong>中药方剂推荐：</strong></p>';
            html += '<ul>';
            for (const herb of result.herbRecommendations) {
              html += `<li>${herb}</li>`;
            }
            html += '</ul>';
          }
          
          if (result.dietaryAdvice && result.dietaryAdvice.length > 0) {
            html += '<p><strong>饮食建议：</strong></p>';
            html += '<ul>';
            for (const advice of result.dietaryAdvice) {
              html += `<li>${advice}</li>`;
            }
            html += '</ul>';
          }
          
          if (result.lifestyleAdvice && result.lifestyleAdvice.length > 0) {
            html += '<p><strong>生活方式建议：</strong></p>';
            html += '<ul>';
            for (const advice of result.lifestyleAdvice) {
              html += `<li>${advice}</li>`;
            }
            html += '</ul>';
          }
          
          resultsContainer.innerHTML = html;
        } catch (error) {
          resultsContainer.innerHTML = `<div class="error">分析失败: ${error.message}</div>`;
        }
      }
      
      // 诊断类型选项切换
      document.querySelectorAll('.diagnostic-option').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const targetId = this.id.replace('include', '');
          const selectorDiv = document.getElementById(`${targetId.toLowerCase()}DataSelector`);
          
          if (selectorDiv) {
            selectorDiv.style.display = this.checked ? 'block' : 'none';
          }
        });
      });
      
      // 脉诊分析测试功能
      function analyzePulse() {
        const frequency = document.getElementById('pulseFrequency').value;
        const strength = document.getElementById('pulseStrength').value;
        const rhythm = document.getElementById('pulseRhythm').value;
        const userId = document.getElementById('pulseUserId').value.trim();
        const resultsContainer = document.getElementById('pulseResults');
        
        resultsContainer.innerHTML = '<div class="loading">分析中，请稍候...</div>';
        
        const pulseData = {
          frequency: parseInt(frequency),
          strength: parseFloat(strength),
          rhythm
        };
        
        fetch('/api/diagnostic/pulse', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
          },
          body: JSON.stringify({
            pulseData,
            userId: userId || undefined
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          return response.json();
        })
        .then(result => {
          let html = `<h3>脉诊分析结果 (ID: ${result.id})</h3>`;
          html += `<p><strong>脉象类型：</strong> ${result.pulseType}</p>`;
          html += `<p><strong>诊断结果：</strong> ${result.diagnosis}</p>`;
          
          html += '<p><strong>脉象特征：</strong></p>';
          html += '<ul>';
          for (const characteristic of result.characteristics) {
            html += `<li>${characteristic}</li>`;
          }
          html += '</ul>';
          
          html += '<p><strong>调理建议：</strong></p>';
          html += '<ul>';
          for (const recommendation of result.recommendations) {
            html += `<li>${recommendation}</li>`;
          }
          html += '</ul>';
          
          resultsContainer.innerHTML = html;
        })
        .catch(error => {
          resultsContainer.innerHTML = `<div class="error">分析失败: ${error.message}</div>`;
        });
      }
      
      // 更新脉搏强度显示值
      document.getElementById('pulseStrength').addEventListener('input', function() {
        const value = parseFloat(this.value);
        let strengthText = '中等';
        
        if (value < 0.2) {
          strengthText = '很弱';
        } else if (value < 0.4) {
          strengthText = '较弱';
        } else if (value < 0.6) {
          strengthText = '中等';
        } else if (value < 0.8) {
          strengthText = '较强';
        } else {
          strengthText = '很强';
        }
        
        document.getElementById('pulseStrengthValue').textContent = strengthText;
      });
      
      // 体质分析测试功能
      function analyzeConstitution() {
        const userAnswers = {};
        const answerElements = document.querySelectorAll('.constitution-answer');
        
        answerElements.forEach(element => {
          const question = element.getAttribute('data-question');
          userAnswers[question] = element.value;
        });
        
        const userId = document.getElementById('constitutionUserId').value.trim();
        const resultsContainer = document.getElementById('constitutionResults');
        
        resultsContainer.innerHTML = '<div class="loading">分析中，请稍候...</div>';
        
        fetch('/api/diagnostic/constitution', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
          },
          body: JSON.stringify({
            userAnswers,
            userId: userId || undefined
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          return response.json();
        })
        .then(result => {
          let html = `<h3>体质分析结果 (ID: ${result.id})</h3>`;
          html += `<p><strong>主要体质：</strong> ${result.primaryType} (得分: ${result.primaryScore.toFixed(1)})</p>`;
          
          if (result.secondaryTypes && result.secondaryTypes.length > 0) {
            html += '<p><strong>次要体质：</strong></p>';
            html += '<ul>';
            for (const type of result.secondaryTypes) {
              html += `<li>${type.type} (得分: ${type.score.toFixed(1)})</li>`;
            }
            html += '</ul>';
          }
          
          html += '<p><strong>调理建议：</strong></p>';
          html += '<ul>';
          for (const recommendation of result.recommendations) {
            html += `<li>${recommendation}</li>`;
          }
          html += '</ul>';
          
          html += '<p><strong>饮食建议：</strong></p>';
          html += '<ul>';
          for (const suggestion of result.dietSuggestions) {
            html += `<li>${suggestion}</li>`;
          }
          html += '</ul>';
          
          html += '<p><strong>生活方式建议：</strong></p>';
          html += '<ul>';
          for (const suggestion of result.lifestyleSuggestions) {
            html += `<li>${suggestion}</li>`;
          }
          html += '</ul>';
          
          resultsContainer.innerHTML = html;
        })
        .catch(error => {
          resultsContainer.innerHTML = `<div class="error">分析失败: ${error.message}</div>`;
        });
      }
      
      // 查询诊断历史
      function getDiagnosticHistory() {
        const userId = document.getElementById('historyUserId').value.trim();
        const type = document.getElementById('historyType').value;
        const limit = document.getElementById('historyLimit').value;
        const resultsContainer = document.getElementById('historyResults');
        
        if (!userId) {
          showAlert('请输入用户ID');
          return;
        }
        
        resultsContainer.innerHTML = '<div class="loading">查询中，请稍候...</div>';
        
        let url = `/api/diagnostic/${userId}/history?limit=${limit}`;
        if (type) {
          url += `&type=${type}`;
        }
        
        fetch(url, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (!data.history || data.history.length === 0) {
            resultsContainer.innerHTML = '<div class="message">未找到诊断历史记录</div>';
            return;
          }
          
          let html = `<h3>诊断历史记录 (共${data.history.length}条)</h3>`;
          html += '<div class="history-list">';
          
          for (const item of data.history) {
            html += `
              <div class="history-item">
                <div class="history-header">
                  <span class="history-type">${getDiagnosticTypeLabel(item.type)}</span>
                  <span class="history-date">${formatDate(item.timestamp)}</span>
                </div>
                <div class="history-content">
              `;
              
              if (item.type === 'tongue') {
                html += `
                  <p><strong>诊断：</strong> ${item.analysis.diagnosis}</p>
                  <p><strong>特征：</strong> ${item.analysis.features.join(', ')}</p>
                `;
              } else if (item.type === 'pulse') {
                html += `
                  <p><strong>脉型：</strong> ${item.analysis.pulseType}</p>
                  <p><strong>诊断：</strong> ${item.analysis.diagnosis}</p>
                `;
              } else if (item.type === 'constitution') {
                html += `
                  <p><strong>主要体质：</strong> ${item.analysis.primaryType}</p>
                  <p><strong>次要体质：</strong> ${item.analysis.secondaryTypes.map(t => t.type).join(', ')}</p>
                `;
              }
              
              html += `
                </div>
                <div class="history-id">ID: ${item.id}</div>
              </div>
            `;
          }
          
          html += '</div>';
          resultsContainer.innerHTML = html;
        })
        .catch(error => {
          resultsContainer.innerHTML = `<div class="error">查询失败: ${error.message}</div>`;
        });
      }
      
      // 获取诊断类型标签
      function getDiagnosticTypeLabel(type) {
        const labels = {
          'tongue': '舌诊',
          'pulse': '脉诊',
          'constitution': '体质分析',
          'face': '面诊',
          'voice': '声诊',
          'comprehensive': '综合诊断'
        };
        
        return labels[type] || type;
      }
      
      // 格式化日期
      function formatDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        
        return `${year}-${month}-${day} ${hours}:${minutes}`;
      }
      
      // 显示图像预览
      document.getElementById('tongueImage').addEventListener('change', function(e) {
        showImagePreview(this, 'tonguePreview');
      });
      
      document.getElementById('faceImage').addEventListener('change', function(e) {
        showImagePreview(this, 'facePreview');
      });
      
      document.getElementById('comprehensiveTongueImage').addEventListener('change', function(e) {
        showImagePreview(this, 'comprehensiveTonguePreview');
      });
      
      document.getElementById('comprehensiveFaceImage').addEventListener('change', function(e) {
        showImagePreview(this, 'comprehensiveFacePreview');
      });
      
      // 显示音频预览
      document.getElementById('voiceAudio').addEventListener('change', function(e) {
        const audioControls = document.getElementById('audioControls');
        audioControls.innerHTML = '';
        
        if (this.files && this.files[0]) {
          const audioUrl = URL.createObjectURL(this.files[0]);
          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = audioUrl;
          audio.style.width = '100%';
          
          audioControls.appendChild(audio);
        }
      });
      
      function showImagePreview(input, previewId) {
        const preview = document.getElementById(previewId);
        preview.innerHTML = '';
        
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '200px';
            preview.appendChild(img);
          }
          
          reader.readAsDataURL(input.files[0]);
        }
      }
      
      // 将函数暴露到全局作用域
      window.analyzeTongue = analyzeTongue;
      window.analyzePulse = analyzePulse;
      window.analyzeFace = analyzeFace;
      window.analyzeVoice = analyzeVoice;
      window.analyzeConstitution = analyzeConstitution;
      window.analyzeComprehensive = analyzeComprehensive;
      window.getDiagnosticHistory = getDiagnosticHistory;
      
      // 推荐系统相关函数
      function generateHealthPlan() {
        const userId = document.getElementById('healthUserId').value;
        const constitution = document.getElementById('healthConstitution').value;
        const conditions = document.getElementById('healthConditions').value;
        
        if (!userId) {
          showAlert('请输入用户ID');
          return;
        }
        
        const outputArea = document.getElementById('healthPlanOutput');
        outputArea.innerHTML = '<div class="loading">生成中，请稍候...</div>';
        
        // 发送API请求
        fetch('/api/recommendation/health-plan', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
          },
          body: JSON.stringify({
            userId,
            constitution,
            conditions: conditions.split(',').map(item => item.trim()).filter(item => item)
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          outputArea.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        })
        .catch(error => {
          outputArea.innerHTML = `<div class="error">生成失败: ${error.message}</div>`;
        });
      }
      
      function generateHerbFood() {
        const userId = document.getElementById('herbFoodUserId').value;
        const constitution = document.getElementById('herbFoodConstitution').value;
        const season = document.getElementById('herbFoodSeason').value;
        const symptoms = document.getElementById('herbFoodSymptoms').value;
        
        if (!userId) {
          showAlert('请输入用户ID');
          return;
        }
        
        const outputArea = document.getElementById('herbFoodOutput');
        outputArea.innerHTML = '<div class="loading">生成中，请稍候...</div>';
        
        // 发送API请求
        fetch('/api/recommendation/herb-food', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
          },
          body: JSON.stringify({
            userId,
            constitution,
            season,
            symptoms: symptoms.split(',').map(item => item.trim()).filter(item => item)
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          outputArea.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        })
        .catch(error => {
          outputArea.innerHTML = `<div class="error">生成失败: ${error.message}</div>`;
        });
      }
      
      function generateTreatmentPlan() {
        const userId = document.getElementById('treatmentUserId').value;
        const pattern = document.getElementById('treatmentPattern').value;
        const symptoms = document.getElementById('treatmentSymptoms').value;
        const history = document.getElementById('treatmentHistory').value;
        
        if (!userId) {
          showAlert('请输入用户ID');
          return;
        }
        
        if (!pattern) {
          showAlert('请选择证型');
          return;
        }
        
        const outputArea = document.getElementById('treatmentOutput');
        outputArea.innerHTML = '<div class="loading">生成中，请稍候...</div>';
        
        // 发送API请求
        fetch('/api/recommendation/treatment-plan', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
          },
          body: JSON.stringify({
            userId,
            pattern,
            symptoms,
            history
          })
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          outputArea.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        })
        .catch(error => {
          outputArea.innerHTML = `<div class="error">生成失败: ${error.message}</div>`;
        });
      }
      
      function queryUserPlans() {
        const userId = document.getElementById('queryUserId').value;
        const planType = document.getElementById('queryPlanType').value;
        const limit = document.getElementById('queryLimit').value;
        
        if (!userId) {
          showAlert('请输入用户ID');
          return;
        }
        
        const tableBody = document.querySelector('#plansTable tbody');
        tableBody.innerHTML = '<tr><td colspan="5" class="text-center"><div class="loading">查询中，请稍候...</div></td></tr>';
        
        // 发送API请求
        fetch(`/api/recommendation/user-plans?userId=${userId}&type=${planType}&limit=${limit}`, {
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.plans && data.plans.length > 0) {
            tableBody.innerHTML = '';
            data.plans.forEach(plan => {
              const row = document.createElement('tr');
              row.innerHTML = `
                <td>${plan.id}</td>
                <td>${getPlanTypeName(plan.type)}</td>
                <td>${plan.name}</td>
                <td>${formatDate(plan.createdAt)}</td>
                <td>
                  <button class="action-button" onclick="viewPlan('${plan.id}')">查看</button>
                </td>
              `;
              tableBody.appendChild(row);
            });
          } else {
            tableBody.innerHTML = '<tr><td colspan="5" class="text-center">未找到任何方案</td></tr>';
          }
        })
        .catch(error => {
          tableBody.innerHTML = `<tr><td colspan="5" class="text-center error">查询失败: ${error.message}</td></tr>`;
        });
      }
      
      function getPlanTypeName(type) {
        const types = {
          'health_plan': '健康方案',
          'herb_food': '药膳食疗',
          'treatment_plan': '治疗方案'
        };
        return types[type] || type;
      }
      
      function viewPlan(planId) {
        // 向API发送请求获取详细信息
        fetch(`/api/recommendation/plan/${planId}`, {
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`请求失败: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          // 创建模态框
          const modal = document.createElement('div');
          modal.className = 'modal';
          
          const modalContent = document.createElement('div');
          modalContent.className = 'modal-content';
          
          const closeButton = document.createElement('span');
          closeButton.className = 'close-button';
          closeButton.innerHTML = '&times;';
          closeButton.onclick = function() {
            document.body.removeChild(modal);
          };
          
          const title = document.createElement('h2');
          title.textContent = '方案详情';
          
          const content = document.createElement('pre');
          content.className = 'modal-pre';
          content.textContent = JSON.stringify(data, null, 2);
          
          modalContent.appendChild(closeButton);
          modalContent.appendChild(title);
          modalContent.appendChild(content);
          modal.appendChild(modalContent);
          
          document.body.appendChild(modal);
          
          // 点击模态框外部关闭
          window.onclick = function(event) {
            if (event.target == modal) {
              document.body.removeChild(modal);
            }
          };
        })
        .catch(error => {
          showAlert(`获取方案失败: ${error.message}`);
        });
      }
      
      // 暴露推荐系统函数到全局作用域
      window.generateHealthPlan = generateHealthPlan;
      window.generateHerbFood = generateHerbFood;
      window.generateTreatmentPlan = generateTreatmentPlan;
      window.queryUserPlans = queryUserPlans;
      window.viewPlan = viewPlan;
    });
  </script>
</body>
</html> 